if [ "$#" -ne 2 ]; then
    echo "You must enter exactly 2 command line arguments"
fi
echo $#

. /$1/appl_data/CDW2/properties/set_up_EACS1.sh

ydate=`date +%Y-%m-%d -d"1 day ago"`

bteq .LOGON TDDEV/EACSNDW_LOAD_01,Pa02word <<EOFF >> $EACS_LOG_DIR/DIM_JOB_SUB_GROUP_SLA_`date +%Y-%m-%d`.log

CREATE MULTISET VOLATILE TABLE ECS_DIM_JOB_SLA ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT
     (
	  SLA_ID VARCHAR(200) CHARACTER SET LATIN NOT CASESPECIFIC NOT NULL,    
	  SLA_TYPE VARCHAR(200) CHARACTER SET LATIN NOT CASESPECIFIC,
      SLA_DESCRIPTION VARCHAR(200) CHARACTER SET LATIN NOT CASESPECIFIC,
      SLA_AGREEMENT_TIME VARCHAR(200) CHARACTER SET LATIN NOT CASESPECIFIC,
      SLA_NUMBER VARCHAR(200) CHARACTER SET LATIN NOT CASESPECIFIC,
      ACTIVE_FLAG VARCHAR(200) CHARACTER SET LATIN NOT CASESPECIFIC NOT NULL,	 
 )
ON COMMIT PRESERVE ROWS ;
.IMPORT VARTEXT ','  FILE=$2

.QUIET ON
.REPEAT *
.PACK 20000
USING 
(     
	  SLA_ID VARCHAR(400),
	  SLA_TYPE VARCHAR(400),
      SLA_DESCRIPTION VARCHAR(400),
	  SLA_AGREEMENT_TIME VARCHAR(400),
      SLA_NUMBER VARCHAR(400),
      ACTIVE_FLAG VARCHAR(400)
      )        
INSERT INTO ECS_DIM_JOB_SLA
    ( 
	  SLA_ID,
	  SLA_TYPE,
      SLA_DESCRIPTION,
	  SLA_AGREEMENT_TIME,
      SLA_NUMBER,
      ACTIVE_FLAG   
)
VALUES ( 	  
	  :SLA_ID,
	  :SLA_TYPE,
      :SLA_DESCRIPTION,
	  :SLA_AGREEMENT_TIME,
      :SLA_NUMBER,
      :ACTIVE_FLAG  
);
.IF ERRORCODE > 0 THEN .QUIT ERRORCODE 

INSERT INTO DIM_JOB_SLA
(	  
	  SLA_ID,
	  SLA_TYPE,
      SLA_DESCRIPTION,
	  SLA_AGREEMENT_TIME,
      SLA_NUMBER,
      ACTIVE_FLAG ,
	  UPD_DTTM,
	  UPD_USR_ID,
	  CRT_DTTM,
	  CRT_USR_ID
	)
SELECT  
	  SLA_ID,
	  SLA_TYPE,
      SLA_DESCRIPTION,
	  SLA_AGREEMENT_TIME,
      SLA_NUMBER,
      ACTIVE_FLAG 
	  ,CURRENT_TIMESTAMP(0)
	  ,'EACSNDW_LOAD_01'
	  ,CURRENT_TIMESTAMP(0)
	  ,'EACSNDW_LOAD_01'
	  FROM ECS_DIM_JOB_SLA;
	
.IF ERRORCODE > 0 THEN .QUIT ERRORCODE 
.LOGOFF
.QUIT
EOFF

ERRORCODE=${PIPESTATUS[0]}

if [ $ERRORCODE -ne 0 ]; then 
echo ""
echo "INFO: The BTEQ to insert data to the ECS_DIM_JOB_SUB_GROUP_SLA  table failed on `date` "
echo ""
fi
